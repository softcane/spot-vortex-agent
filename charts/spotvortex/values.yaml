# SpotVortex Helm values


# Cloud this deployment targets.
cloud: aws

mode:
  # Shadow mode (default: true). Runs read-only: logs savings, risk, and recommendations
  # without executing drains. Set to false for active mode (requires explicit opt-in).
  dryRun: true

controller:
  riskThreshold: 0.85
  maxDrainRatio: 0.10
  reconcileIntervalSeconds: 30
  confidenceThreshold: 0.50
  drainGracePeriodSeconds: 60

inference:
  # Models are expected to be bundled in the container image or mounted externally.
  tftModelPath: "models/tft.onnx"
  rlModelPath: "models/rl_policy.onnx"
  modelManifestPath: "models/MODEL_MANIFEST.json"
  # Must match manifest cloud (if set).
  expectedCloud: "aws"

prometheus:
  enabled: true
  url: "http://prometheus:9090"
  timeoutSeconds: 10

aws:
  # Used by price provider fallback path.
  region: "us-east-1"
  # Optional catalog hints for pricing workflows (not model-scope enforcement).
  instanceTypes: []
  availabilityZones: []

gcp:
  projectId: ""
  region: "us-central1"
  # Optional catalog hints for pricing workflows (not model-scope enforcement).
  machineTypes: []

# Autoscaling (ASG) integration for Cluster Autoscaler and EKS Managed Nodegroups.
# Per integration_strategy.md Section 4: Twin ASG model.
autoscaling:
  enabled: false
  discoveryTags:
    pool: "spotvortex.io/pool"
    type: "spotvortex.io/capacity-type"
  nodeReadyTimeoutSeconds: 300
  pollIntervalSeconds: 10

karpenter:
  enabled: true
  useExtendedPoolId: false
  spotNodePoolSuffix: "-spot"
  onDemandNodePoolSuffix: "-od"
  spotWeight: 100
  onDemandWeight: 10
  managedWorkloadPools: []
  weightChangeCooldownSeconds: 60
  usePoolLevelInference: true
  respectDisruptionBudgets: true

agent:
  image:
    repository: ghcr.io/spotvortex/agent
    tag: "1.1.0"
    pullPolicy: IfNotPresent

  replicas: 1

  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 512Mi

  nodeSelector: {}
  tolerations:
    - key: "kubernetes.io/arch"
      operator: "Equal"
      value: "amd64"
      effect: "NoSchedule"

rbac:
  create: true

serviceAccount:
  create: true
  name: spotvortex
  # IRSA: uncomment annotations and set your IAM role ARN (see docs/IAM_PERMISSIONS.md)
  # annotations:
  #   eks.amazonaws.com/role-arn: arn:aws:iam::ACCOUNT:role/spotvortex-shadow
  annotations: {}
