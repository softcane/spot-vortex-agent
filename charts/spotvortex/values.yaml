# SpotVortex Helm values

# Optional API key. Leave empty for free/local usage.
apiKey: ""

# Cloud this deployment targets.
cloud: aws

mode:
  # Shadow mode (default: true). Runs read-only: logs savings, risk, and recommendations
  # without executing drains. Set to false for active mode (requires explicit opt-in).
  dryRun: true

controller:
  riskThreshold: 0.85
  maxDrainRatio: 0.10
  reconcileIntervalSeconds: 30
  confidenceThreshold: 0.50
  drainGracePeriodSeconds: 60

inference:
  # Models are expected to be bundled in the container image or mounted externally.
  tftModelPath: "models/tft.onnx"
  rlModelPath: "models/rl_policy.onnx"
  modelManifestPath: "models/MODEL_MANIFEST.json"
  # Must match manifest cloud (if set).
  expectedCloud: "aws"

prometheus:
  enabled: true
  url: "http://prometheus:9090"
  timeoutSeconds: 10

aws:
  # Used by price provider fallback path.
  region: "us-east-1"
  # Optional catalog hints for pricing workflows (not model-scope enforcement).
  instanceTypes: []
  availabilityZones: []

gcp:
  projectId: ""
  region: "us-central1"
  # Optional catalog hints for pricing workflows (not model-scope enforcement).
  machineTypes: []

# Autoscaling (ASG) integration for Cluster Autoscaler and EKS Managed Nodegroups.
# Per integration_strategy.md Section 4: Twin ASG model.
autoscaling:
  enabled: false
  discoveryTags:
    pool: "spotvortex.io/pool"
    type: "spotvortex.io/capacity-type"
  nodeReadyTimeoutSeconds: 300
  pollIntervalSeconds: 10

karpenter:
  # Default off for broad install compatibility. Enable on clusters where Karpenter CRDs exist.
  enabled: false
  useExtendedPoolId: false
  spotNodePoolSuffix: "-spot"
  onDemandNodePoolSuffix: "-od"
  spotWeight: 100
  onDemandWeight: 10
  managedWorkloadPools: []
  weightChangeCooldownSeconds: 60
  usePoolLevelInference: true
  respectDisruptionBudgets: true

agent:
  image:
    repository: ghcr.io/softcane/spot-vortex-agent
    # Empty means "use .Chart.AppVersion".
    tag: ""
    pullPolicy: IfNotPresent
  # Explicit file path for ONNX shared library inside the container.
  # This overrides image-level defaults and keeps startup deterministic.
  onnxRuntimeLibraryPath: "/usr/local/lib/onnxruntime/libonnxruntime.so.1.23.2"

  replicas: 1
  metricsPort: 8080
  probes:
    enabled: true
    readiness:
      initialDelaySeconds: 5
      periodSeconds: 10
      timeoutSeconds: 3
      failureThreshold: 6
    liveness:
      initialDelaySeconds: 20
      periodSeconds: 20
      timeoutSeconds: 3
      failureThreshold: 3

  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 512Mi

  nodeSelector: {}
  tolerations:
    - key: "kubernetes.io/arch"
      operator: "Equal"
      value: "amd64"
      effect: "NoSchedule"

rbac:
  create: true

serviceAccount:
  create: true
  name: spotvortex
  # IRSA: uncomment annotations and set your IAM role ARN (see docs/IAM_PERMISSIONS.md)
  # annotations:
  #   eks.amazonaws.com/role-arn: arn:aws:iam::ACCOUNT:role/spotvortex-shadow
  annotations: {}
